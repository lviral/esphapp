<link rel="import" href="../dal/rest-api.html">
<link rel="import" href="com-factura-pendiente.html">

<dom-module id="com-servicio-pendiente">
    
    <template>
        <style>
            .contenedor {
                width: 90%;
                margin: 0 auto;
            }
            .encabezado {
                padding: 5px;
            },
            

            :host[show] {
              @apply(--layout-horizontal);
              @apply(--layout-around-justified);
              @apply(--layout-wrap);
              height: 100%;
              max-width: 1000px;
              margin: 0 auto;
              background-color: var(--paper-grey-50);
              width: 100%;
              margin-top: 50px;
            }

            paper-card {
              /*max-width: 900px;
              min-width: 400px;*/
             
            }
            @media all and (min-width: 700px) {
              :host[show] {
                @apply(--layout-justified);
              }
              paper-card {
                width: calc(50% - 100px);
              }
              paper-card + paper-card {
                margin-left: 100px;
              }
            }

            @media all and (min-width: 1200px) {
              :host {
                width: 90%;
              }
            }   

        </style>
        
        <rest-api query-string="ConsultarFacturasPendientes/{{contrato}}-{{codigoTipoServicio}},/{{codigoTipoBusqueda}}/{{codigoBusqueda}}" 
                  respuesta="{{respuesta}}"></rest-api>
        
        <div>
            <paper-card style="width:100%; margin: 0 auto;">
                <div class="encabezado">
                    <div>Contrato: {{contrato}}</div>
                    <template is="dom-if" if="{{nombreCliente}}">
                        <div>Cliente: {{nombreCliente}}</div>
                        <div>Tipo: {{descripcionServicio}}</div>
                    </template>
                </div>
                <template is="dom-repeat" items="{{respuesta}}" as="factura">
                    <template is="dom-if" if="{{nombreCliente}}">
                        <com-factura-pendiente data="{{factura}}" on-custom-change="_calcularTotal"></com-factura-pendiente>
                    </template>
                    <template is="dom-if" if="{{!nombreCliente}}">
                        <span>No tiene pendientes!</span>
                    </template>
                </template>
            <paper-card>
        </div>
    </template> 

  <script>

    Polymer({

      is: 'com-servicio-pendiente',
        
      properties: {
          respuesta: Object,
          contrato: String,
          codigoTipoServicio: String,
          codigoTipoBusqueda: {
              type: String,
              value: '1'
          },
          codigoBusqueda: {
              type: String,
              value: 'CON'
          },
          identificacionCliente: {
              type: String,
              computed: '_setIdentificacionCliente(respuesta)'
          },
          nombreCliente: {
              type: String,
              computed: '_setNombreCliente(respuesta)'
          },
          descripcionServicio: {
              type: String,
              computed: '_setDescripcionServicio(respuesta)'
          },
          montoTotal: {
              type: Number,
              value: 0
          },
          todasSeleccionadas: {
              type: Boolean,
              value: false
          }
      },
      _setIdentificacionCliente: function(data){
          return data[0].identificacion;
      },
      _setNombreCliente: function(data){
          return data[0].nombreCliente;
      },
      _setDescripcionServicio: function(data){
          return data[0].descripcionServicio;
      },
      _calcularTotal: function(e, factura){
          if(factura.seleccionada)
            this.montoTotal += factura.monto;
          else
            this.montoTotal -= factura.monto;
          this.fire('cambio-monto-total', factura);
      },
      _seleccionarTodasFacturas: function(data) {
          var listaFacturas = Polymer.dom(this.root).querySelectorAll('com-factura-pendiente');
          this.todasSeleccionadas = data;
          listaFacturas.forEach(factura => {
              factura._seleccionar(this.todasSeleccionadas);
          });
      }
    });

  </script>

</dom-module>
